<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitesofcode&#39;s Terrain Generation &middot; 3bf57cec3c37</title>

    <meta name="description" content="">

    <meta name="generator" content="Hugo 0.17" />
    <meta name="twitter:card" content="summary">
    

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">

    <link rel="stylesheet" href="https://erasche.github.io//css/all.min.css">
    <link rel="stylesheet" href="https://erasche.github.io//assets/main.css">
    <link rel="alternate" type="application/rss+xml" title="3bf57cec3c37" href="https://erasche.github.io//index.xml" />

    <meta name="theme-color" content="#3d4f5d">
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            
            <img src="https://erasche.github.io/assets/pics/me3.png" width="80%" style="max-width: 240px;">
            
            <h1 class="brand-title"><a href="https://erasche.github.io/">3bf57cec3c37</a></h1>
            <h2 class="brand-tagline"></h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a class="pure-button" href="https://erasche.github.io//index.xml"><i class="fa fa-rss"></i> RSS</a>
                </li>
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/Eric_Rasche"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/erasche "><i class="fa fa-github-alt"></i> GitHub</a>
                </li>
                
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4" style="padding: 0;">
        <div class="size-chart pure-g">
	<a class="size-chart-item" href="https://erasche.github.io/" style="width: 20%;background: #1f8dd6; color: white; padding: 1em">
		<div class="size-chart-base pure-u">
			<span class="size-chart-label">
				Home
			</span>
		</div>
	</a>
	<a class="size-chart-item" href="https://erasche.github.io/post/" style="width: 20%;background: #265778; color: white; padding: 1em">
		<div class="size-chart-base pure-u">
			<span class="size-chart-label">
				Blog
			</span>
		</div>
	</a>
	<a class="size-chart-item" href="https://erasche.github.io/talks/" style="width: 20%;background: #5eb95e; color: white; padding: 1em">
		<div class="size-chart-base pure-u">
			<span class="size-chart-label">
				Talks
			</span>
		</div>
	</a>
	<a class="size-chart-item" href="https://erasche.github.io/software/" style="width: 20%;background: #dd514c; color: white; padding: 1em">
		<div class="size-chart-base pure-u">
			<span class="size-chart-label">
				Software
			</span>
		</div>
	</a>
	<a class="size-chart-item" href="https://erasche.github.io/assets/rasche_cv.pdf" style="width: 20%;background: rgb(243, 123, 29); color: white; padding: 1em">
		<div class="size-chart-base pure-u">
			<span class="size-chart-label">
				Resume
			</span>
		</div>
	</a>
</div>

        <div style="padding-left: 1em; padding-right: 1em; margin-left: auto; margin-right: auto;">
            
            <div class="posts">
                <h1 class="content-subhead">2017-01-22 01:29:05 &#43;0000 UTC</h1>
                <section class="post">
                    <header class="post-header">

                        <div>
                            
                            <a href="https://erasche.github.io/post/2017-01-22-bitesofcode-landscape/" class="post-title">Bitesofcode&#39;s Terrain Generation</a>
                        </div>
                        



                        <div>
                            
                            <a class="pure-button button-secondary" href="https://erasche.github.io/tags/dev">dev</a>
                            
                            <a class="pure-button button-secondary" href="https://erasche.github.io/tags/mapgen">mapgen</a>
                            
                        </div>

                        <div id="toc" class="pure-u-1">
                            
                        </div>
                    </header>
                    <div class="post-description">
                        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.4.1/d3.min.js" integrity="sha256-4mL8TQfOJSbg0f42dQw5cKLl2ngQXUSXqfQnvK11M44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

<p>Found <a href="https://bitesofcode.wordpress.com/2016/12/23/landscape-generation-using-midpoint-displacement/">this</a> blog post and enjoyed the graphics. Re-implementing in JS for a learning exercise.</p>

<p>I started this post with the idea of doing fancy controls but&hellip; meh. No time for this, so you just get pretty pictures.</p>

<div id="plots">
</div>

<script src="https://erasche.github.io/js/bitesofcode.js"></script>

<p>And here&rsquo;s my code:</p>

<div class="highlight" style="background: #f0f0f0"><pre style="line-height: 125%"><span style="color: #60a0b0; font-style: italic">// Adapt to viewport</span>
<span style="color: #007020; font-weight: bold">var</span> width <span style="color: #666666">=</span> $(<span style="color: #4070a0">&#39;section.post&#39;</span>).width();
<span style="color: #60a0b0; font-style: italic">// A 1:2 ratio looks nicer.</span>
<span style="color: #007020; font-weight: bold">var</span> height <span style="color: #666666">=</span> width <span style="color: #666666">/</span> <span style="color: #40a070">2</span>;

<span style="color: #60a0b0; font-style: italic">// Color function borrowed from original post</span>
<span style="color: #007020; font-weight: bold">function</span> color(idx){
	<span style="color: #007020; font-weight: bold">var</span> colors <span style="color: #666666">=</span> [
		[<span style="color: #40a070">195</span>, <span style="color: #40a070">157</span>, <span style="color: #40a070">224</span>],
		[<span style="color: #40a070">158</span>, <span style="color: #40a070">98</span>, <span style="color: #40a070">204</span>],
		[<span style="color: #40a070">130</span>, <span style="color: #40a070">79</span>, <span style="color: #40a070">138</span>],
		[<span style="color: #40a070">68</span>, <span style="color: #40a070">28</span>, <span style="color: #40a070">99</span>],
		[<span style="color: #40a070">49</span>, <span style="color: #40a070">7</span>, <span style="color: #40a070">82</span>],
		[<span style="color: #40a070">23</span>, <span style="color: #40a070">3</span>, <span style="color: #40a070">38</span>],
		[<span style="color: #40a070">240</span>, <span style="color: #40a070">203</span>, <span style="color: #40a070">163</span>]
	];
	<span style="color: #007020; font-weight: bold">return</span> <span style="color: #4070a0">&#39;rgb(&#39;</span> <span style="color: #666666">+</span> colors[idx][<span style="color: #40a070">0</span>] <span style="color: #666666">+</span> <span style="color: #4070a0">&#39;,&#39;</span> <span style="color: #666666">+</span> colors[idx][<span style="color: #40a070">1</span>] <span style="color: #666666">+</span> <span style="color: #4070a0">&#39;,&#39;</span> <span style="color: #666666">+</span>colors[idx][<span style="color: #40a070">2</span>] <span style="color: #666666">+</span> <span style="color: #4070a0">&#39;)&#39;</span>;
}

<span style="color: #60a0b0; font-style: italic">// Setup the SVG object on the page</span>
<span style="color: #007020; font-weight: bold">function</span> _prep_svg(){
	<span style="color: #007020; font-weight: bold">var</span> svg <span style="color: #666666">=</span> d3.select(<span style="color: #4070a0">&quot;#plots&quot;</span>).append(<span style="color: #4070a0">&#39;svg&#39;</span>)
		.attr(<span style="color: #4070a0">&quot;width&quot;</span>, width)
		.attr(<span style="color: #4070a0">&quot;height&quot;</span>, height);
	<span style="color: #007020; font-weight: bold">return</span> svg;
}

<span style="color: #60a0b0; font-style: italic">// Setup various objects needed by all the plot functions</span>
<span style="color: #007020; font-weight: bold">function</span> _prep_plot(){
	<span style="color: #007020; font-weight: bold">var</span> x <span style="color: #666666">=</span> d3.scaleLinear().range([<span style="color: #40a070">0</span>, width]),
		y <span style="color: #666666">=</span> d3.scaleLinear().range([height, <span style="color: #40a070">0</span>]);

	x.domain([<span style="color: #40a070">0</span>, <span style="color: #40a070">256</span>]);
	y.domain([<span style="color: #40a070">0</span>, height]);

	<span style="color: #007020; font-weight: bold">var</span> area <span style="color: #666666">=</span> d3.area()
		.x(<span style="color: #007020; font-weight: bold">function</span>(d) { <span style="color: #007020; font-weight: bold">return</span> x(d[<span style="color: #40a070">0</span>]);  })
		.y0(height)
		.y1(<span style="color: #007020; font-weight: bold">function</span>(d) { <span style="color: #007020; font-weight: bold">return</span> y(d[<span style="color: #40a070">1</span>]);  });

	<span style="color: #007020; font-weight: bold">return</span> [x, y, area];
}

<span style="color: #60a0b0; font-style: italic">// Plot a single data series</span>
<span style="color: #007020; font-weight: bold">function</span> plot(data){
	plot_multi([
		{
			data<span style="color: #666666">:</span> data,
			color<span style="color: #666666">:</span> <span style="color: #4070a0">&#39;gray&#39;</span>,
		}
	])
};

<span style="color: #60a0b0; font-style: italic">// Plot more than one data series</span>
<span style="color: #007020; font-weight: bold">function</span> plot_multi(data_arr, svg){
	<span style="color: #60a0b0; font-style: italic">// arr of</span>
	<span style="color: #60a0b0; font-style: italic">// {data: data, color: color}</span>

	<span style="color: #60a0b0; font-style: italic">// Get our components</span>
	<span style="color: #007020; font-weight: bold">if</span>(svg <span style="color: #666666">===</span> <span style="color: #007020; font-weight: bold">undefined</span>){
		svg <span style="color: #666666">=</span> _prep_svg();
	}
	<span style="color: #007020; font-weight: bold">var</span> [x, y, area] <span style="color: #666666">=</span> _prep_plot();

	<span style="color: #60a0b0; font-style: italic">// For each {data: data, color: color} in the data_arr, append an SVG path element.</span>
	data_arr.forEach(<span style="color: #007020; font-weight: bold">function</span>(d){
		svg.append(<span style="color: #4070a0">&quot;path&quot;</span>)
			.data([d.data])
			.attr(<span style="color: #4070a0">&quot;class&quot;</span>, <span style="color: #4070a0">&quot;area&quot;</span>)
			.attr(<span style="color: #4070a0">&quot;d&quot;</span>, area)
			.attr(<span style="color: #4070a0">&quot;fill&quot;</span>, d.color);
	})
	<span style="color: #60a0b0; font-style: italic">// Return the SVG in case we want to re-use it.</span>
	<span style="color: #007020; font-weight: bold">return</span> svg;
};

<span style="color: #007020; font-weight: bold">function</span> getRandomArbitrary(min, max) {
	<span style="color: #60a0b0; font-style: italic">// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random</span>
	<span style="color: #007020; font-weight: bold">return</span> <span style="color: #007020">Math</span>.random() <span style="color: #666666">*</span> (max <span style="color: #666666">-</span> min) <span style="color: #666666">+</span> min;
}

<span style="color: #60a0b0; font-style: italic">// Midpoint displacement algorithm, completely copied from bitesofcode website.</span>
<span style="color: #007020; font-weight: bold">function</span> midpoint_displacement(start, end, roughness, vertical_displacement, num_of_iterations){
	<span style="color: #007020; font-weight: bold">if</span>(vertical_displacement <span style="color: #666666">!==</span> <span style="color: #007020; font-weight: bold">undefined</span>){
		vertical_displacement <span style="color: #666666">=</span> (start <span style="color: #666666">+</span> end) <span style="color: #666666">/</span> <span style="color: #40a070">2</span>;
	}
	<span style="color: #007020; font-weight: bold">if</span>(num_of_iterations <span style="color: #666666">===</span> <span style="color: #007020; font-weight: bold">undefined</span>){
		num_of_iterations <span style="color: #666666">=</span> <span style="color: #40a070">16</span>;
	}

	points <span style="color: #666666">=</span> [start, end];
	<span style="color: #007020; font-weight: bold">var</span> iteration <span style="color: #666666">=</span> <span style="color: #40a070">1</span>;
	<span style="color: #007020; font-weight: bold">while</span>(iteration <span style="color: #666666">&lt;=</span> num_of_iterations) {
		<span style="color: #007020; font-weight: bold">var</span> new_points <span style="color: #666666">=</span> [];
		<span style="color: #007020; font-weight: bold">for</span>(<span style="color: #007020; font-weight: bold">var</span> i <span style="color: #666666">=</span> <span style="color: #40a070">0</span>; i <span style="color: #666666">&lt;</span> points.length <span style="color: #666666">-</span> <span style="color: #40a070">1</span>; i<span style="color: #666666">++</span>){
			<span style="color: #60a0b0; font-style: italic">// Get the bounding points</span>
			<span style="color: #007020; font-weight: bold">var</span> left <span style="color: #666666">=</span> points[i];
			<span style="color: #007020; font-weight: bold">var</span> right <span style="color: #666666">=</span> points[i <span style="color: #666666">+</span> <span style="color: #40a070">1</span>];
			<span style="color: #60a0b0; font-style: italic">// Average for new midpoint</span>
			<span style="color: #007020; font-weight: bold">var</span> midpoint <span style="color: #666666">=</span> (left <span style="color: #666666">+</span> right) <span style="color: #666666">/</span> <span style="color: #40a070">2</span>;
			<span style="color: #60a0b0; font-style: italic">// Apply displacement</span>
			midpoint <span style="color: #666666">+=</span> getRandomArbitrary(<span style="color: #666666">-</span>vertical_displacement, vertical_displacement);
			new_points.push(left);
			new_points.push(midpoint);
		}
		<span style="color: #60a0b0; font-style: italic">// Include the last &#39;right&#39; since it wasn&#39;t caught before.</span>
		new_points.push(points[points.length <span style="color: #666666">-</span> <span style="color: #40a070">1</span>]);
		<span style="color: #60a0b0; font-style: italic">// Replace points</span>
		points <span style="color: #666666">=</span> new_points;
		<span style="color: #60a0b0; font-style: italic">// Smooth out vertical displacement</span>
		vertical_displacement <span style="color: #666666">=</span> <span style="color: #007020">Math</span>.pow(<span style="color: #40a070">2</span>, <span style="color: #666666">-</span>roughness) <span style="color: #666666">*</span> vertical_displacement;
		iteration<span style="color: #666666">++</span>;
	}

	<span style="color: #007020; font-weight: bold">var</span> num_points <span style="color: #666666">=</span> points.length <span style="color: #666666">-</span> <span style="color: #40a070">1</span>;
	<span style="color: #007020; font-weight: bold">return</span> points.map(<span style="color: #007020; font-weight: bold">function</span>(x, i){
		<span style="color: #007020; font-weight: bold">return</span> [
			<span style="color: #60a0b0; font-style: italic">// Convert [10, 20, 10] to [[0, 10], [128, 20], [256, 10]]</span>
			<span style="color: #40a070">256</span> <span style="color: #666666">*</span> i <span style="color: #666666">/</span> num_points,
			<span style="color: #60a0b0; font-style: italic">// But we also want to re-scale vertically since our height changes</span>
			<span style="color: #60a0b0; font-style: italic">// on smaller devices. on small devices height could be ~100.</span>
			<span style="color: #60a0b0; font-style: italic">// Everything would be off the page.</span>
			x <span style="color: #666666">*</span> height <span style="color: #666666">/</span> <span style="color: #40a070">600</span>
		];
	});
};

<span style="color: #60a0b0; font-style: italic">// Try out a test plot</span>
points <span style="color: #666666">=</span> midpoint_displacement(<span style="color: #40a070">150</span>, <span style="color: #40a070">200</span>, <span style="color: #40a070">1.4</span>, <span style="color: #40a070">20</span>, <span style="color: #40a070">8</span>);
plot(points);

<span style="color: #60a0b0; font-style: italic">// Now try a more complex one</span>
plot_multi([
	{
		data<span style="color: #666666">:</span> midpoint_displacement(<span style="color: #40a070">450</span>, <span style="color: #40a070">420</span>, <span style="color: #40a070">0.9</span>, <span style="color: #40a070">250</span>, <span style="color: #40a070">8</span>),
		color<span style="color: #666666">:</span> color(<span style="color: #40a070">5</span>),
	},
	{
		data<span style="color: #666666">:</span> midpoint_displacement(<span style="color: #40a070">350</span>, <span style="color: #40a070">320</span>, <span style="color: #40a070">1.0</span>, <span style="color: #40a070">250</span>, <span style="color: #40a070">8</span>),
		color<span style="color: #666666">:</span> color(<span style="color: #40a070">4</span>),
	},
	{
		data<span style="color: #666666">:</span> midpoint_displacement(<span style="color: #40a070">260</span>, <span style="color: #40a070">320</span>, <span style="color: #40a070">0.9</span>, <span style="color: #40a070">250</span>, <span style="color: #40a070">8</span>),
		color<span style="color: #666666">:</span> color(<span style="color: #40a070">3</span>),
	},
	{
		data<span style="color: #666666">:</span> midpoint_displacement(<span style="color: #40a070">200</span>, <span style="color: #40a070">190</span>, <span style="color: #40a070">1</span>, <span style="color: #40a070">120</span>, <span style="color: #40a070">9</span>),
		color<span style="color: #666666">:</span> color(<span style="color: #40a070">2</span>),
	},
	{
		data<span style="color: #666666">:</span> midpoint_displacement(<span style="color: #40a070">100</span>, <span style="color: #40a070">80</span>, <span style="color: #40a070">1.2</span>, <span style="color: #40a070">30</span>, <span style="color: #40a070">12</span>),
		color<span style="color: #666666">:</span> color(<span style="color: #40a070">1</span>),
	},
	{
		data<span style="color: #666666">:</span> midpoint_displacement(<span style="color: #40a070">0</span>, <span style="color: #40a070">100</span>, <span style="color: #40a070">1.4</span>, <span style="color: #40a070">20</span>, <span style="color: #40a070">12</span>),
		color<span style="color: #666666">:</span> color(<span style="color: #40a070">0</span>),
	},
]);

<span style="color: #60a0b0; font-style: italic">// And lastly fully imitate the original.</span>
<span style="color: #007020; font-weight: bold">var</span> svg <span style="color: #666666">=</span> _prep_svg();

svg.append(<span style="color: #4070a0">&quot;rect&quot;</span>)
	.attr(<span style="color: #4070a0">&quot;x&quot;</span>, <span style="color: #40a070">0</span>)
	.attr(<span style="color: #4070a0">&quot;y&quot;</span>, <span style="color: #40a070">0</span>)
	.attr(<span style="color: #4070a0">&quot;width&quot;</span>, width)
	.attr(<span style="color: #4070a0">&quot;height&quot;</span>, height)
	.attr(<span style="color: #4070a0">&quot;fill&quot;</span>, color(<span style="color: #40a070">6</span>));

<span style="color: #60a0b0; font-style: italic">// sun</span>
svg.append(<span style="color: #4070a0">&quot;ellipse&quot;</span>)
	.attr(<span style="color: #4070a0">&quot;cx&quot;</span>, <span style="color: #40a070">50</span>)
	.attr(<span style="color: #4070a0">&quot;cy&quot;</span>, <span style="color: #40a070">50</span>)
	.attr(<span style="color: #4070a0">&quot;rx&quot;</span>, <span style="color: #40a070">25</span>)
	.attr(<span style="color: #4070a0">&quot;ry&quot;</span>, <span style="color: #40a070">25</span>)
	.attr(<span style="color: #4070a0">&quot;fill&quot;</span>, <span style="color: #4070a0">&quot;white&quot;</span>);

<span style="color: #60a0b0; font-style: italic">// Layers</span>
plot_multi([
	{ data<span style="color: #666666">:</span> midpoint_displacement(<span style="color: #40a070">350</span>, <span style="color: #40a070">320</span>, <span style="color: #40a070">0.9</span>, <span style="color: #40a070">250</span>, <span style="color: #40a070">8</span>),    color<span style="color: #666666">:</span> color(<span style="color: #40a070">0</span>)},
	{ data<span style="color: #666666">:</span> midpoint_displacement(<span style="color: #40a070">270</span>, <span style="color: #40a070">190</span>, <span style="color: #40a070">1</span>, <span style="color: #40a070">120</span>, <span style="color: #40a070">9</span>),      color<span style="color: #666666">:</span> color(<span style="color: #40a070">1</span>)},
	{ data<span style="color: #666666">:</span> midpoint_displacement(<span style="color: #40a070">180</span>, <span style="color: #40a070">80</span>, <span style="color: #40a070">1.2</span>, <span style="color: #40a070">30</span>, <span style="color: #40a070">12</span>),     color<span style="color: #666666">:</span> color(<span style="color: #40a070">2</span>)},
	{ data<span style="color: #666666">:</span> midpoint_displacement(<span style="color: #40a070">250</span>, <span style="color: #40a070">200</span>, <span style="color: #40a070">1.4</span>, <span style="color: #40a070">20</span>, <span style="color: #40a070">12</span>),    color<span style="color: #666666">:</span> color(<span style="color: #40a070">3</span>)},
], svg);
</pre></div>


                    </div>
                </section>
            </div>
            <div class="footer well">
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
			<div>
				<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0 Intl</a>
			</div>
			<div>Powered by <a class="hugo" href="https://gohugo.io/" target="_blank">hugo</a></div>
	</div>
</div>

        </div>
    </div>
</div>
</body>
</html>
